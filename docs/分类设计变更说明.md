# 分类设计变更说明

## 1. 背景

在项目初期设计中，文章和视频的分类信息直接存储在主表的`category`字段中。随着业务发展，我们发现这种设计存在以下问题：

1. 分类信息无法灵活扩展和管理
2. 无法实现多分类关联
3. 分类统计和查询效率低下
4. 不符合数据库设计范式

因此，我们决定将分类设计重构为独立的分类表和关联表。

## 2. 设计变更内容

### 2.1 数据库表结构调整

#### 2.1.1 移除主表中的category字段

从以下两个表中移除了`category`字段：
- `health_articles`（健康文章表）
- `health_videos`（健康视频表）

#### 2.1.2 保留独立的分类表

继续使用以下分类表：
- `article_categories`（文章分类表）
- `video_categories`（视频分类表）

#### 2.1.3 使用关联表实现多对多关系

通过以下关联表实现文章/视频与分类的多对多关系：
- `article_category_relations`（文章分类关联表）
- `video_category_relations`（视频分类关联表）

### 2.2 Java实体类调整

#### 2.2.1 移除实体类中的category字段

从以下实体类中移除了`category`字段：
- [HealthArticles](file:///C:/Users/DELL/Desktop/%E6%AF%95%E8%AE%BE%E4%BB%A3%E5%81%9A/%E5%9F%BA%E4%BA%8ESpringBoot%E7%9A%84%E7%A4%BE%E5%8C%BA%E5%8D%AB%E7%94%9F%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/SmartHealthHub/src/main/java/com/xitian/smarthealthhub/domain/entity/HealthArticles.java#L17-L107)
- [HealthVideos](file:///C:/Users/DELL/Desktop/%E6%AF%95%E8%AE%BE%E4%BB%A3%E5%81%9A/%E5%9F%BA%E4%BA%8ESpringBoot%E7%9A%84%E7%A4%BE%E5%8C%BA%E5%8D%AB%E7%94%9F%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/SmartHealthHub/src/main/java/com/xitian/smarthealthhub/domain/entity/HealthVideos.java#L17-L57)

#### 2.2.2 移除VO类中的category字段

从以下VO类中移除了`category`字段：
- [HealthArticleVO](file:///C:/Users/DELL/Desktop/%E6%AF%95%E8%AE%BE%E4%BB%A3%E5%81%9A/%E5%9F%BA%E4%BA%8ESpringBoot%E7%9A%84%E7%A4%BE%E5%8C%BA%E5%8D%AB%E7%94%9F%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/SmartHealthHub/src/main/java/com/xitian/smarthealthhub/domain/vo/HealthArticleVO.java#L16-L83)
- [HealthVideoVO](file:///C:/Users/DELL/Desktop/%E6%AF%95%E8%AE%BE%E4%BB%A3%E5%81%9A/%E5%9F%BA%E4%BA%8ESpringBoot%E7%9A%84%E7%A4%BE%E5%8C%BA%E5%8D%AB%E7%94%9F%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/SmartHealthHub/src/main/java/com/xitian/smarthealthhub/domain/vo/HealthVideoVO.java#L13-L81)

#### 2.2.3 服务层处理分类关联

服务层通过[CategoryRelationService](file:///C:/Users/DELL/Desktop/%E6%AF%95%E8%AE%BE%E4%BB%A3%E5%81%9A/%E5%9F%BA%E4%BA%8ESpringBoot%E7%9A%84%E7%A4%BE%E5%8C%BA%E5%8D%AB%E7%94%9F%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/SmartHealthHub/src/main/java/com/xitian/smarthealthhub/service/CategoryRelationService.java)处理分类关联：
- 创建文章/视频时，同时创建分类关联记录
- 更新文章/视频时，更新分类关联记录
- 查询文章/视频时，需要额外查询关联表获取分类信息

### 2.3 接口调整

#### 2.3.1 创建和更新接口

创建和更新文章/视频的接口保持不变，仍然通过`category`字段传递分类ID列表（JSON格式）：
- 创建文章：`POST /health-articles/create`
- 更新文章：`POST /health-articles/update`
- 创建视频：`POST /health-videos/create`
- 更新视频：`POST /health-videos/update`

#### 2.3.2 查询接口

查询接口需要调整以支持通过关联表查询：
- 管理端分页查询文章：`POST /health-articles/page`
- 用户端分页查询文章：`POST /health-articles/public/page`
- 管理端分页查询视频：`POST /health-videos/page`
- 用户端分页查询视频：`POST /health-videos/public/page`

注意：目前查询逻辑尚未完全重构，后续需要实现通过关联表进行分类查询。

## 3. 后续工作

### 3.1 查询逻辑重构

需要重构查询逻辑，实现通过关联表进行分类查询，包括：
- 在查询条件中添加通过分类ID查询文章/视频的功能
- 在返回结果中包含文章/视频关联的分类信息

### 3.2 VO对象调整

需要在VO对象中添加分类信息字段，并在转换时从关联表获取分类信息。

### 3.3 前端适配

前端需要根据新的接口规范进行适配，特别是在显示和筛选分类信息时。

## 4. 注意事项

1. 本次修改移除了主表中的`category`字段，请确保数据库表结构已同步更新
2. 服务层代码已更新，但查询逻辑仍需进一步重构
3. 前端在调用创建和更新接口时，仍可使用原有的`category`字段传递分类信息
4. 如遇到"Unknown column 'category' in 'field list'"错误，请检查数据库表结构是否已更新
5. VO类中的`category`字段也已移除，后续会在查询时动态添加分类信息